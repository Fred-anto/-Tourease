<div class="container mt-5 creations-new">
  <div class="row justify-content-center">
    <div class="col-md-8">
      <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
          <h2 class="mb-0">Create a New Activity ✨</h2>
        </div>

        <div class="card-body">
          <%= simple_form_for @activity, html: { multipart: true } do |f| %>

            <!-- Image -->
            <div class="form-group mb-3" data-controller="file-input">
              <label class="form-label d-block mb-2">Image</label>

              <%= f.input :photo,
                    as: :file,
                    label: false,
                    wrapper: false,
                    input_html: {
                      class: "d-none",
                      accept: "image/*",
                      data: {
                        "file-input-target": "input",
                        action: "change->file-input#update"
                      }
                    } %>

              <button type="button"
                      class="btn btn-outline-secondary rounded-pill"
                      data-action="click->file-input#pick"
                      aria-controls="photo-filename">
                Choose file
              </button>

              <span id="photo-filename"
                    class="text-muted ms-2"
                    data-file-input-target="name">
                No photo chosen
              </span>

              <div class="invalid-feedback d-block">
                <%= f.error :photo %>
              </div>
            </div>

            <!-- Activity name -->
            <div class="form-group">
              <%= f.input :name, label: "Activity Name", input_html: { class: "form-control" } %>

              <!-- Address (Mapbox) -->
              <div class="mb-3"
                   data-controller="address-autocomplete"
                   data-address-autocomplete-api-key-value="<%= ENV['MAPBOX_API_KEY'] %>">

                <!-- Label manuel pour garder l’astérisque (champ hidden) -->
                <label class="form-label mb-1">
                  Address <span class="required">*</span>
                </label>

                <!-- UI du geocoder avec le rendu .form-control -->
                <div class="form-control p-0"
                     data-address-autocomplete-target="container"></div>

                <!-- Champ soumis -->
                <%= f.input :address,
                      as: :hidden,
                      label: false,
                      input_html: {
                        data: { "address-autocomplete-target": "address" }
                      } %>

                <div class="invalid-feedback d-block">
                  <%= f.error :address %>
                </div>
              </div>
            </div>

            <!-- Description -->
            <div class="form-group">
              <%= f.input :description, as: :text, label: "Description",
                          input_html: { rows: 4, class: "form-control" } %>
            </div>

            <!-- Categories -->
            <div class="form-group">
              <label class="form-label mb-2">Pick a Category</label>
              <div class="category-grid">
                <% Category.all.each do |category| %>
                  <% checkbox_id = "activity_category_ids_#{category.id}" %>
                  <div class="category-tile">
                    <%= f.radio_button :category_id, category.id, id: checkbox_id, class: "category-checkbox" %>
                    <label for="<%= checkbox_id %>" class="category-content">
                      <%= category.name %>
                    </label>
                  </div>
                <% end %>
              </div>
            </div>

            <!-- Submit -->
            <div class="form-group d-flex mt-4 gap-3">
              <%= f.submit "➕ Create activity", class: "btn btn-primary" %>
            </div>

          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>
