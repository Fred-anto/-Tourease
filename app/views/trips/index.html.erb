<%= render "shared/navbar" %>

<%# Pr√©pare les collections une seule fois %>
<% current_trips = @trips.select { |t| t.end_date && t.end_date > Date.current } %>
<% past_trips    = @trips.select { |t| t.end_date && t.end_date < Date.current } %>

<%# Tri d√©croissant par cr√©ation pour les current trips %>
<% current_trips_sorted = current_trips.sort_by(&:created_at).reverse %>

<% if current_trips_sorted.empty? && past_trips.empty? %>
  <!-- ===== Empty state ===== -->
  <div class="container mt-5">
    <div class="row justify-content-center">
      <div class="col-md-8">
        <div class="text-center my-5">
          <i class="fa-regular fa-face-sad-tear fa-3x text-muted mb-3"></i>
          <p class="mb-2">No trips yet...</p>
          <%= link_to "Create your first trip", new_trip_path, class: "btn-new" %>
        </div>
      </div>
    </div>
  </div>
<% else %>

  <% if current_trips_sorted.any? %>
    <div class="container mt-5">
      <div class="row justify-content-center">
        <div class="col-md-8">
          <div class="section-block align-with-cards">
            <h2 class="mb-4 section-title">
              <span class="chip-title">My Current Trips</span>
            </h2>

            <div class="swipe-carousel" data-controller="swipe">
              <div class="swipe-carousel__track" data-swipe-target="track" role="region" aria-label="Current trips">
                <% current_trips_sorted.each do |trip| %>
                  <div class="card h-100 position-relative"><!-- n√©cessaire pour stretched-link -->
                    <!-- lien √©tir√© qui couvre TOUTE la card -->
                    <%= link_to "", trip_path(trip), class: "stretched-link", aria: { label: "View #{trip.name}" } %>

                    <%= image_tag trip_cover_url(trip), class: "card-img-top", alt: (trip.destination || trip.name) %>

                    <div class="card-body">
                      <h5 class="card-title mb-1"><b><%= trip.name %></b></h5>

                      <%# Dates sous le nom (format compact) %>
                      <% if trip.start_date.present? && trip.end_date.present? %>
                        <p class="card-subtitle text-muted mb-2">
                          <%= l(trip.start_date, format: "%b %d %Y") %> ‚Äì <%= l(trip.end_date, format: "%b %d %Y") %>
                        </p>
                      <% elsif trip.start_date.present? %>
                        <p class="card-subtitle text-muted mb-2">
                          <%= l(trip.start_date, format: "%d %b %Y") %>
                        </p>
                      <% elsif trip.end_date.present? %>
                        <p class="card-subtitle text-muted mb-2">
                          <%= l(trip.end_date, format: "%d %b %Y") %>
                        </p>
                      <% end %>

                      <%# Mood en chip sous les dates %>
                      <% if trip.mood.present? %>
                        <div class="mt-n1">
                          <span class="chip"><%= trip.mood %></span>
                        </div>
                      <% end %>
                    </div>

                    <div class="card-footer bg-transparent">
                      <h6 class="mb-1">üìç <%= trip.destination %></h6>
                    </div>
                  </div>
                <% end %>
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>
  <% end %>

  <% if past_trips.any? %>
    <div class="container mt-5">
      <div class="row justify-content-center">
        <div class="col-md-8">
          <div class="section-block align-with-cards">
            <h2 class="mb-4 section-title">
              <span class="chip-title">My past trips</span>
            </h2>

            <div class="swipe-carousel" data-controller="swipe">
              <div class="swipe-carousel__track" data-swipe-target="track" role="region" aria-label="Past trips">
                <% past_trips.first(10).each do |trip| %>
                  <div class="card h-100 position-relative"><!-- n√©cessaire pour stretched-link -->
                    <!-- lien √©tir√© qui couvre TOUTE la card -->
                    <%= link_to "", trip_path(trip), class: "stretched-link", aria: { label: "View #{trip.name}" } %>

                    <%= image_tag trip_cover_url(trip), class: "card-img-top", alt: (trip.destination || trip.name) %>

                    <div class="card-body">
                      <h5 class="card-title mb-1"><b><%= trip.name %></b></h5>

                      <%# Dates sous le nom (format compact) %>
                      <% if trip.start_date.present? && trip.end_date.present? %>
                        <p class="card-subtitle text-muted mb-2">
                          <%= l(trip.start_date, format: "%d %b %Y") %> ‚Äì <%= l(trip.end_date, format: "%d %b %Y") %>
                        </p>
                      <% elsif trip.start_date.present? %>
                        <p class="card-subtitle text-muted mb-2">
                          <%= l(trip.start_date, format: "%d %b %Y") %>
                        </p>
                      <% elsif trip.end_date.present? %>
                        <p class="card-subtitle text-muted mb-2">
                          <%= l(trip.end_date, format: "%d %b %Y") %>
                        </p>
                      <% end %>

                      <%# Mood en chip sous les dates %>
                      <% if trip.mood.present? %>
                        <div class="mt-n1">
                          <span class="chip chip--mint"><%= trip.mood %></span>
                        </div>
                      <% end %>
                    </div>

                    <div class="card-footer bg-transparent">
                      <h6 class="mb-1"> üìç <%= trip.destination %></h6>
                    </div>
                  </div>
                <% end %>
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>
  <% end %>

<% end %>
